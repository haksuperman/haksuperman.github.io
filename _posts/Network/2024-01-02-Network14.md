---
title: DHCP      # 글 제목
date: 2024-01-02 01:10:00 +0900 # 작성 시간
categories: [ON-PREMISE, NETWORK]        # [대분류, 소분류]
tags: [network, dhcp, dora]     # 태그 (반드시 소문자로 시작 권장)
---
L2 Switch

\- L2 계층(Ethernet 기술 사용)에서 사용되는 장치

\- 각 호스트들이 통신을 하려면 각각 1:1로 연결시켜야 하기 때문에 n-1개의 NIC카드가 필요함

\- 각 호스트들 사이에 중간 다리 역할로 멀티포트가 있는 장치를 두어 하나의 호스트만 있어도 통신이 가능하도록 함

(MultiPort Bridge) -> Multi Access 환경을 가능하게 해줌

\- Multi Access 환경에서 각 호스트들을 구분하기 위해 MAC 주소를 사용함, 각 호스트들의 원활한 통신을 위해 CSMA/CD 프로토콜을 사용함

\* MAC

\- 각 호스트들 장비에서는 NIC마다 부여, 스위치에서는 포트마다 부여

\- 24bit(6byte)로 구성

\-- 앞 3byte : OUI(장비의 제조사 번호)

\-- 뒤 3byte : 각 장비의 식별 코드

\-- \[OUI\]:\[NIC\]

\- 전 세계적으로 유일한 주소

\- L2 계층에서 사용되는 장비 중 허브와 비교됨

\-- 허브와 다르게 스위치는 흐름제어가 가능해, 별도의 채널을 만들어 1:1 통신이 가능함

(각각의 다른 채널을 만들어 동시 전송이 가능함)

\-- 허브는 이러한 1:1 채널을 만들지 못해 누군가가 통신 중이면 기다려야 함, 이를 위해 CSMA/CD가 탄생

\- ARP 프로토콜을 이용해 목적지의 MAC 주소를 알아옴(스위치는 '해당 포트로 보내야 해당 목적지로만 전송되구나'를 파악함)

\-- ARP 테이블에 등록시켜 캐시 형태로 더욱더 빠르게 통신이 가능하도록 함

\- 비교적 라우터보다 스위치를 작업할 상황이 더 많음

L3 Switch

\- L2 Switch에 IP 정보를 추가해 외부 네트워크와(브로드캐스트 도메인을 넘어) 통신이 가능하도록 함

\- MAC으로는 Broadcast Domain 내에서만 통신이 가능함, 이를 IP 정보까지 추가시켜 외부 네트워크와도 통신이 가능하도록 함

\* Broadcast Domain : Broadcast 통신이 가능한 범위, Broadcast 패킷이 전달되는 범위,

이 범위를 동일 네트워크로 제한함(Limited Broadcasting Domain)

(Broadcast : 송신자가 속해 있는 네트워크 내의 속한 모든 수신자에게 전달)

\=> 하나의 Network와 동일, 하나의 LAN과 동일, 하나의 IP Subnet과 동일한 의미

\- VLAN 기술로 동일 네트워크 내에서도 구분이 생겨, WAN 구간이 아닌 L2(LAN) 구간의 Ethernet 성능을 뽑아내기 위해 라우터 대신 L3 Switch가 생김

\- 헤더에 IP 정보가 들어가기 때문에 IP 통신이 가능함(인터페이스에 IP 부여 가능, no switchport 명령으로 switch 기능을 제한 경우)

InterVLAN Routing

\- 스위치가 논리적으로 나눠준 네트워크(LAN)을 VLAN이라고 함

\- 각 장비의 인터페이스 별로 VLAN을 구분함(vlan 10, 20), 구분한 이 인터페이스 별로 전기 흐름을 제한함(흐름제어)

\= 소프트웨어적 흐름제어(라우터는 물리적인 장비를 통해 구분, 하드웨어적 흐름제어)

\- SVI, Routed Interface 등의 기술이 사용됨

\- SVI : 논리적인 가상 인터페이스를 만들어 라우터의 인터페이스처럼 사용

(L2 인터페이스를 유지하면서 IP가 필요한 상황에서 가상의 인터페이스를 만들어 사용 가능, VLAN의 게이트웨이로 사용하는 경우가 대부분)

\- Routed Interface : 라우터의 인터페이스와 동일하게 사용(no swichport 명령으로)

(L2 스위치의 인터페이스를 포기하고 라우터의 인터페이스로 사용함)

\- 서로 물리적으로 다른 스위치 사이의 VLAN을 InterVALN Routing으로 통신시킴

\- 헤더에 vlan tag 정보를 붙여 어느 vlan인지 구분함

\- turnk port는 하나 이상의 vlan의 정보를 가짐(그 어느 vlan에도 속하지 않기 때문)

\- access port는 하나의 vlan만 가질 수 있음

\- 스위치와 스위치의 vlan 통신은 trunk 설정, 스위치와 각 호스트(각 vlan)의 통신은 access 설정

DNS

\- Name Address

ex) [www.labs.com](https://www.labs.com/). -> 사람

\-- FQDN(Fully Qualified Domain Name) : Host name + Domain name

\- IP Address

ex) 10.0.10.254/24 -> 기계

\-- IP : Network Bit + Host Bit

\- Name Address와 IP Address의 매치 정보를 DB에 저장시켜 공표함

\- 이러한 DNS의 매치 정보를 Name Server라는 DB가 관리함(www.iana.org 참고)

DHCP(Dynamic Host Configuration Protocol)

\- IP를 호스트들에게 자동으로 부여하는 방법(<-> Static)

​

![image](https://blog.kakaocdn.net/dna/CzHt1/btsC0aXIhP4/AAAAAAAAAAAAAAAAAAAAAAOCrdJePVBrLq-QNtwurnUnMbShrmGvDfXhb4utFCPB/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=26QTLcZiy%2FY7Y03kZAsDuqKrmag%3D)
![image](https://blog.kakaocdn.net/dna/OpAFD/btsCSBoK0Nz/AAAAAAAAAAAAAAAAAAAAAHa1moBDJ5y9lr7BQ5HlI1oUDjC47nf_3YHEy_RBQCl1/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=pA16ZLsYDqswrcw24ZIkldL0lcw%3D)

이러한 DHCP의 IP 할당을 기간을 정해 '이 기간동안만 써'하고 임대를 해줌

(이 기간이 끝나면 바로 연장or회수)

ex) 7일(T1)의 임대 기간을 부여 받은 경우

1) 7일 만료 전 7일의 절반인 시점에 연장 여부를 확인(T1/2)

1-1) 연장할 경우 3.5일 시점에 7일을 연장

1-2) 연장하지 않는 경우 -> T1의 7/8 시점에 연장 여부를 재확인

\=> 두 번의 연장여부를 확인하고 만료 시킴(너무 짧은 임대기간을 갖게 되면, 이 확인 과정이 빈번해짐 -> 불필요한 패킷 교환 과정이 됨)

​

![image](https://blog.kakaocdn.net/dna/rOKTs/btsCTyrR8zX/AAAAAAAAAAAAAAAAAAAAAPv0pUg2Ldp1tCgPcPOodsmszwQhNiyj2GA22N1RPnQK/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=mHdDi6qdRcgSS%2FNjWw3CrXs97J0%3D)

ASW에서 vlan 할당, DSW에서 분배로 역할을 나눔(DSW가 없으면 ASW에서 vlan 할당, 분배를 모두 해야함 -> 부하가 큼)

\-> DSW에서 가상 인터페이스 생성 후 가상 인터페이스가 게이트웨이 역할을 함

DRA(DHCP Relay Agent)

![image](https://blog.kakaocdn.net/dna/c5TwSA/btsCOBCZ48w/AAAAAAAAAAAAAAAAAAAAAGGsFV4KAY60kku4sPF1dUWkxxr-7N6q6DJUW7ypSXhE/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=98eJvE1AiiWcJFiny%2BGzOrqXtuI%3D)

\- 다른 네트워크 대역의 DHCP 서버는 이용하지 못함 -> ip를 가질 수 있는 가상 인터페이스(int vlan 30)를 통해 DRA로 대신 전달하고 전달 받아 줌

\- int V30의 SVI는 ip를 가질 수 있기 때문에 유니캐스트 통신이 가능

\* DHCP 서버를 스위치가 아닌 상위 계층의 장비들로 DHCP 서버를 사용하는 경우(스위치에 DHCP 서버 설정이 아닌 리눅스와 같은 os에 서버를 올려서 사용할 때)

\- 스위치가 아닌 DHCP 서버는 vlan 정보를 모름, 이럴 때 서버가 각 vlan 정보를 어떻게 읽어야 하냐(스위치가 아니라 trunk 설정도 x)

\-> vlan 정보 확인이 가능한 랜카드를 따로 장착해서 사용해야 함

\* DHCP 서버(리눅스)를 서버팜에 두는 경우(일반 서버인 경우)

\- 서버팜과 호스트들을 하나의 네트워크로 사용할 때 그냥 중간에 SW를 두는 것도 방법임(전체가 하나의 네트워크일 경우에만)

---

DHCP 설정 방법

ip dhcp pool \[범위이름\]

![image](https://blog.kakaocdn.net/dna/cTaMt8/btsCZ9kc3A0/AAAAAAAAAAAAAAAAAAAAAGViBig-rZNfX40ihIAqH2siDedgl5wRp2DWmwL_Pd_F/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=yT31UrYFDaDx4I5zCBTu0rNngI4%3D)

network 10.0.10.0 /24

\-> 이 범위 중 게이트웨이 주소 하나 빼야 함

​

​

![image](https://blog.kakaocdn.net/dna/E6nDY/btsCQ21k4Ld/AAAAAAAAAAAAAAAAAAAAAIJ1upuc4Kx1N5UGSscNhMSBjp1p6VoWf52-TDBqgsLr/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=VmHiHqVa6b%2BQsMiPP%2FamTXcQttg%3D)

호스트들에 부여할 게이트웨이 지정

​

​

![image](https://blog.kakaocdn.net/dna/DJlBF/btsCX6VzUr8/AAAAAAAAAAAAAAAAAAAAAKEG-BMXaUj3ArXY3_pQwde900LcKx2_LlVNy-11Zqhd/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=6Xpn7vrKCvuQA2pBYH4md6Y01S0%3D)

호스트들에 부여할 nameserver 지정

​

​

![image](https://blog.kakaocdn.net/dna/BXG40/btsCUzKHQVj/AAAAAAAAAAAAAAAAAAAAAJfdiCa6snMS8D4v-9I96TIo_uXkYWphC3dQ5yCzkG4e/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=VDZZsTnns%2BLnPHfXy1iDZzrrWgs%3D)

임대기간 설정

​

​

![image](https://blog.kakaocdn.net/dna/k39Ft/btsCQq86cwf/AAAAAAAAAAAAAAAAAAAAAMBUUKjNzMFFnbD3tH5ImMSDU7HoNhQTNy3k9lVI06Sg/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=JZ66nMOM0tJehLat8D9QTVi3XDQ%3D)

주소 범위에서 게이트웨이로 사용할 주소 제외

​

​

![image](https://blog.kakaocdn.net/dna/etRqik/btsCWLjJLqk/AAAAAAAAAAAAAAAAAAAAAAxiR7xuNPZUCJh6uRi-nkDXRfxdJC-_Vm8yXQxYrSsx/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=KJxVIycY2EvZNSeNi2eHFMb7gX8%3D)

DHCP 서버 활성화

​

​
![image](https://blog.kakaocdn.net/dna/cE5y1M/btsCZ2k4RLr/AAAAAAAAAAAAAAAAAAAAAJXwZPyBfZCF7ygTCvp8tKu0BoOzjXhN7ASpRnBetgUf/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=uibM9TOwLlCN5FwLU8UCKEyMTrc%3D)

DHCP 설정된 것 확인

​

​

![image](https://blog.kakaocdn.net/dna/d3fXcr/btsCWMpoUCI/AAAAAAAAAAAAAAAAAAAAAItX6zbmqtwIa3IMEKMIG6Mt9VXwjzFMKdARnDm-Wm5q/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=qjMDe6u69zLK2gUABzOvwzhudks%3D)

해당 명령으로 임대해준 ip들 확인 가능

​

​

![image](https://blog.kakaocdn.net/dna/v9Npo/btsCN37DJas/AAAAAAAAAAAAAAAAAAAAANgh0rahI5M68iT9wL9WyVoE-ROn53wcqCKYimSS3WTh/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=qMCI%2FMZpWYJinIHghlI3WkV8pSU%3D)

기존에 테스트했던 ip 제거

​

​

![image](https://blog.kakaocdn.net/dna/Y8Tep/btsCWJGenFQ/AAAAAAAAAAAAAAAAAAAAAK4_bEH0u59gjMvW2Cyjh1kuL7UwlZSo__u6hUjB3wgG/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=4o58Jxzw%2BK85dYIOKGSEuyTEFuw%3D)

DORA 과정을 통해 ip 할당

​

​

​

![image](https://blog.kakaocdn.net/dna/b5wpcG/btsCZjN2pSm/AAAAAAAAAAAAAAAAAAAAAIml53ZYtF3ok2ua7z4eCshAZBgZv7ZNtroEgyBNWfPE/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=54tjD%2BTebboAv%2B5aarycSn81WPc%3D)

![image](https://blog.kakaocdn.net/dna/ZlLVA/btsCZhvUvXo/AAAAAAAAAAAAAAAAAAAAAHVjhmDvmhLs0nyBOFt3ovgxA-TKdwdpV1gQsZ1JS9tu/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=CSwFMWzoXU04j0W1XivR3ekDMW8%3D)

![image](https://blog.kakaocdn.net/dna/Y0GbH/btsCScvQVEj/AAAAAAAAAAAAAAAAAAAAACn4Uo74y4msqpVAH_sjMGL6f7J250N2co_yEnz4VhwS/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=zKTdM25jmbL%2BWz4iUhQ4lCsadho%3D)

![image](https://blog.kakaocdn.net/dna/oEtt0/btsCWKyl8pJ/AAAAAAAAAAAAAAAAAAAAALhTGsHCu8w3Qm3stWu3__0hZLq8gsM9SBcq27wGAaMm/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=1NvQEenDccNqnrRo1TUjdxjRopU%3D)

---

![image](https://blog.kakaocdn.net/dna/TmAGt/btsCX44xeBO/AAAAAAAAAAAAAAAAAAAAALTOEaePYmWvQBwGjvHxqWbe2wodLUNf1sRqFNbPaRpK/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=b40XNyxPzZ6awEmTmyhCL6baPV8%3D)
![image](https://blog.kakaocdn.net/dna/bpjU7f/btsCP5jHb0t/AAAAAAAAAAAAAAAAAAAAAPTrRzzv---VSN64tB8lyHSzHV2aQ5FHwBNktCISPzTz/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=1Y2sbyi7%2FDOKxdq6PS1%2Bh3iY1zI%3D)

vlan과 dhcp 설정 후 각 pc들 모두 통신되도록 하기(라우팅 해줘야 함)

![image](https://blog.kakaocdn.net/dna/c9ul6d/btsCZhbBF0U/AAAAAAAAAAAAAAAAAAAAAHHafLHkfs0VvS3cOXkK7JRgwAdnEgrmFT9uEzxkX1Rq/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=f437epL39a45wrA6sNV4h3suZy8%3D)

---

DRA(DHCP Relay Agent)

\- ESW1에만 DHCP 설정이 되어 있을 때(다른 네트워크에 있는 DHCP 서버에서 DRA 설정을 통해 DHCP 클라이언트가 ip를 받아 올 수 있도록)

![image](https://blog.kakaocdn.net/dna/ccoXAD/btsCU0uFHr7/AAAAAAAAAAAAAAAAAAAAAMBixr-ugy5RIex5b2b0oTIkGZPToZky25tURHZRrh9j/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=oGWUErRUnid31ZOJjavgv1VHqs0%3D)

PC7에서 다른 네트워크로 DHCP Discovery 패킷이 넘어가지 못함

![image](https://blog.kakaocdn.net/dna/ck3pl3/btsCQowEv8v/AAAAAAAAAAAAAAAAAAAAAEufJwhRf13iVa7pAbc6wO0JP8RBQc-gcNFvpBXSfpvg/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=6BYAWs%2FnzRPZTogv4ahsZdlgsTA%3D)

릴레이 넘겨줘야 하는 장비의 인터페이스에 helper-address 설정

ip helper-address 도와줘야 하는 인터페이스의 주소(DHCP 서버의 물리적인 인터페이스 주소)

![image](https://blog.kakaocdn.net/dna/btmnnw/btsCZ7GGpDa/AAAAAAAAAAAAAAAAAAAAAB8UIbtKkyC64lgMQypje8nZgrltmrrFvvbVYTpDfMKU/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=HN4QbzIYyr33VMrKwLUFQWH7QxI%3D)

양쪽에 다 설정했던 dhcp 서버 오른쪽 하나 비활성화

![image](https://blog.kakaocdn.net/dna/0LGhp/btsCZjAudLo/AAAAAAAAAAAAAAAAAAAAAM_z5kLiOB1eCQ3MBqPk813loe59BHkZnHZDIfNV0kkT/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=zKlptQ77Ho2wxBl0JpzV4z%2FUQCE%3D)

helper 설정 후 왼쪽 DHCP 서버에서 받아오는지 확인(DRA가 제대로 받아오지 못함)

![image](https://blog.kakaocdn.net/dna/bgyyWo/btsCOzrIm8g/AAAAAAAAAAAAAAAAAAAAAPxo3ISktawPf7F1ae4SocXwi--kbKjr4VWW4Xo4_U7I/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=pqa87%2FhvLLi%2FATBRReM67mATvCM%3D)

출발지를 지정해서 핑을 때려볼 때 핑은 나감

![image](https://blog.kakaocdn.net/dna/sLUJ3/btsCQpvA5r8/AAAAAAAAAAAAAAAAAAAAAKZv7o09Td7t0nLCkOH6mIEAJ1KIYlrQ3eSzuf0zj47V/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=h3v2agmJ83rhcBRQrbqMeIaK9Ag%3D)

agent가 Discover 패킷을 정상적으로 보내줌

\-> 서버에서 Offer 패킷을 보내주지 않는 상태, GNS3 문제

![image](https://blog.kakaocdn.net/dna/csAiED/btsCRgkRAqm/AAAAAAAAAAAAAAAAAAAAAFgNFDk4qm8e98M0381jKq_WZm0LTQfgztC1b9tNt9Kr/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=jb9dmqAPBG4xP76d%2FIX2hMBgGZA%3D)

수동으로 ip 넣고 핑 확인 -> 가능

![image](https://blog.kakaocdn.net/dna/caKDpd/btsCQ19aiuH/AAAAAAAAAAAAAAAAAAAAAJej9Ia90UAjyKG3zC34yS2iYaGaByy-qSH7ByHx-zlb/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=kAINnCKEYINFD%2BZLBrPL6mAzv9A%3D)

ESW2의 arp 테이블에도 수동부여 했던 pc7의 주소 있음(설정 상은 문제없음)

이런 구조일때의 실습은 그냥 양쪽에 DHCP 설정하고 각각 할당 받자ㅠ