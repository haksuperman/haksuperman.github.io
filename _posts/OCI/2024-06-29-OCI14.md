---
title: "[OCI] OCICLI를 활용한 자원 정리 (with. OCI Cloud Shell)"       # 글 제목
date: 2024-06-29 00:23:00 +0900 # 작성 시간
categories: [CLOUD, OCI]        # [대분류, 소분류]
tags: [oci, cloud, oraclecloud, oracle cloud infrastructure, cloudshell, ocicli]     # 태그 (반드시 소문자로 시작 권장)
---
초기에 생성했던 VCN을 제외한 나머지 모든 자원을 삭제할 것이다.

직접 GUI 관리콘솔에서 삭제할 수도 있지만, 명령줄 인터페이스(CLI)를 통해 간편하게 지울 것이다.

## 1\. OCI CLI

OCI CLI를 사용하면 쉘 스크립트, crontab 등과 함께 활용해서 OCI 자원을 자동화하거나, 정기적인 작업을 쉽게 실행할 수 있다.<br>
OCI CLI 뿐만 아니라 프로그래밍 언어를 사용해서도 오라클 클라우드 자원을 제어할 수 있다.<br>
OCI CLI를 사용하는 방법은 두 가지가 있다.
-   운영체제 환경에 OCI CLI를 설치하여 사용하는 방법
-   OCI Cloud Shell을 활용하는 방법

## 2\. OCI Cloud Shell

OCI Cloud Shell을 사용하면 OCI CLI를 설치 및 설정하고, 별도 인증 과정을 거치는 과정 없이도 오라클 클라우드 자원을 쉽게 제어할 수 있다.<br>
OCI Cloud Shell은 OCI 웹 콘솔에서 접근이 가능한 웹 브라우저 기반 터미널 환경으로 Ansible, Terraform과 같은 다양한 개발자 도구가 미리 설치되어 있다.<br>
이를 통해 별도의 환경 구성 없이도 빠르고 간편하게 클라우드 자원을 제어할 수 있다.

1. 우측 상단의 "Developer Tools" 클릭 후 Cloud Shell 클릭
![image](/assets/img/posts/OCI/OCI14_01.png)

2. 최초로 실행하면 튜토리얼을 수행할지 물어보는 질문에 N 입력
![image](/assets/img/posts/OCI/OCI14_02.png)

    > **Cloud Shell 환경 초기화**  
    > Cloud Shell 환경은 csreset -a, csreset -b 명령어를 통해 초기화가 가능하다. "csreset -a" 명령어는 사용자 홈 디렉터리와 프로파일 설정을 초기화한다. 즉, 사용자 데이터와 설정을 모두 제거하고 처음 상태로 돌린다. "csreset -b" 명령어는 브라우저 세션과 관련된 데이터를 초기화한다.
    {: .prompt-info }

3. [Identity & Security → Compartment\] 메뉴 선택
![image](/assets/img/posts/OCI/OCI14_03.png)

3. 컴파트먼트 OCID를 통해 인스턴스 목록 조회
![image](/assets/img/posts/OCI/OCI14_04.png)


4. 파일로도 저장 가능
![image](/assets/img/posts/OCI/OCI14_05.png)
![image](/assets/img/posts/OCI/OCI14_06.png)

## 3\. 자원 정리

자원은 생성한 순서의 역순으로 삭제하면 된다. Autoscaling Configuration, 인스턴스 풀, Instance Configuration, 로드밸런서, 가상 머신, 이미지, 가상 머신, Bastion이다.<br>
이 중 인증서, CA와 마스터 암호화 키 그리고 Vault와 같이 즉시 삭제되지 않고 최소 일주일 이상의 삭제 대기 기간이 필요한 자원은 OCI 웹 콘솔을 통해 삭제한다.<br>
CA의 경우 인증서가 삭제된 이후에 삭제가 가능하다.

#### 1) 삭제할 자원이 속한 컴파트먼트 OCID 환경변수 지정

![image](/assets/img/posts/OCI/OCI14_07.png)

```bash
export COMP\_ID="<컴파트먼트 OCID>"
```

#### 2) Autoscaling Configuration 삭제

Autoscaling Configuration의 OCID를 조회해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 Autoscaling Configuration 삭제

> \--force 옵션을 사용하면 확인 메시지 없이 삭제 작업이 가능하다!
{: .prompt-tip }

```bash
oci autoscaling configuration list -c $COMP\_ID --query 'data\[\*\].{name:"name", id:"id"}' --output table
oci autoscaling configuration delete --force --auto-scaling-configuration-id "<조회한 Autoscaling configuration OCID>"
```
![image](/assets/img/posts/OCI/OCI14_08.png)

#### 3) 인스턴스 풀 삭제

삭제할 인스턴스 풀의 OCID를 조회해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 인스턴스 풀을 삭제한다.

```bash
oci compute-management instance-pool list -c $COMP\_ID --query 'data\[\*\].{name:"display-name", id:"id"}' --output table
oci compute-management instance-pool terminate --force --instance-pool-id "<조회한 인스턴스 풀 1 OCID>"
oci compute-management instance-pool terminate --force --instance-pool-id "<조회한 인스턴스 풀 2 OCID>"
oci compute-management instance-pool terminate --force --instance-pool-id "<조회한 인스턴스 풀 3 OCID>"
```
![image](/assets/img/posts/OCI/OCI14_09.png)


#### 4) Instance Configuration 삭제

삭제할 Instance Configuration의 OCID를 조회해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 Instance Configuration을 삭제한다.

```bash
oci compute-management instance-configuration list -c $COMP\_ID --query 'data\[\*\].{name:"display-name", id:"id"}' --output table
oci compute-management instance-configuration delete --force --instance-configuration-id "<조회한 Instance Configuration OCID>"
```
![image](/assets/img/posts/OCI/OCI14_10.png)

#### 5) 로드밸런서 삭제
삭제할 로드밸런서의 OCID를 조회해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 로드밸런서를 삭제한다.

```bash
oci lb load-balancer list -c $COMP\_ID --query 'data\[\*\].{name:"display-name", id:"id"}' --output table
oci lb load-balancer delete --force --load-balancer-id "<조회한 로드밸런서 OCID>"
```
![image](/assets/img/posts/OCI/OCI14_11.png)

#### 6) 가상 머신 삭제
삭제할 가상 머신의 OCID를 조회해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 가상 머신을 삭제한다.

```bash
oci compute instance list -c $COMP\_ID --query 'data\[\*\].{name:"display-name", id:"id"}' --output table
oci compute instance terminate --force --instance-id "<조회한 가상 머신 1 OCID>"
oci compute instance terminate --force --instance-id "<조회한 가상 머신 2 OCID>"
oci compute instance terminate --force --instance-id "<조회한 가상 머신 3 OCID>"
oci compute instance terminate --force --instance-id "<조회한 가상 머신 4 OCID>"
oci compute instance terminate --force --instance-id "<조회한 가상 머신 5 OCID>"
```
![image](/assets/img/posts/OCI/OCI14_12.png)

#### 7) Bastion 서비스 삭제

삭제할 Bastion 서비스의 OCID를 조ㅚ해서 OCID 값을 얻은 후 이 값을 파라미터로 활용해서 Bastion 서비스를 삭제한다.

```bash
oci bastion bastion list -c $COMP\_ID --query 'data\[\*\].{name:"name", id:"id"}' --output table --all
oci bastion bastion delete --force --bastion-id "<조회한 Bastion 서비스 OCID>"
```
![image](/assets/img/posts/OCI/OCI14_13.png)
