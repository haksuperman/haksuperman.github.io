---
title: "[OCI] OKE Cluster 구축(4) - 접속 환경 설정"       # 글 제목
date: 2026-01-04 19:42:00 +0900 # 작성 시간
categories: [CLOUD, OCI]        # [대분류, 소분류]
tags: [oci, cloud, oraclecloud, oracle cloud infrastructure, oke, kubernetes]     # 태그 (반드시 소문자로 시작 권장)
---

## **1. Bastion 서버 생성**

### **1.1. Basic information**

1. Name : \<적절한 이름 입력>
2. Availability domain : \<사용 중인 AD 선택>
![image](/assets/img/posts/OCI/OCI22_01.png)
    
3. Image and shape
    1. Image : 이용하려는 이미지 선택 (여기서는 Oracle Linux 9 이용)
    2. Shape : \<적절한 Shape 및 OCPU, Memory 선택>OCI22_01.png
    ![image](/assets/img/posts/OCI/OCI22_02.png)
    

### **1.2. Security**

1. Shielded Instance : 체크 해제 (기본 값)
![image](/assets/img/posts/OCI/OCI22_03.png)
    

### **1.3. Networking**

1. Primary network
    1. Virtual cloud network : \<이전 가이드에서 생성한 VCN 선택>
    2. Subnet : \<이전 가이드에서 생성한 Bastion용 서브넷 선택>
    ![image](/assets/img/posts/OCI/OCI22_04.png)
    
2. Primary VNIC IP addresses
    1. Private IPv4 address : \<Private IP의 수동 지정이 필요한 경우 Manually assign private IPv4 address 선택>
    2. Automatically assign public IPv4 address : 체크 해제<br>
    (Reserved IP로 고정해 두는 것이 바람직함, 추후 VNIC 설정에서 Reserved IP 할당 가능)
    ![image](/assets/img/posts/OCI/OCI22_05.png)
    
3. Add SSH keys
    1. Generate a key pair for me 선택
    2. Private key, Public key 다운
    ![image](/assets/img/posts/OCI/OCI22_06.png)
    

### **1.4. Storage**

1. Boot volume
    1. Specify a custom boot volume size 체크
    2. Boot volume size : 50 GB (기본 값 : 46.6 GB)
    ![image](/assets/img/posts/OCI/OCI22_07.png)
    

## **2. Kubernetes 관리자용 유저 생성**

### **2.1. 유저 생성**

```bash
## 유저 생성
[opc@oke-bastion]$ sudo adduser k8s-admin

## 확인
[opc@oke-bastion]$ cat /etc/passwd | grep k8s-admin
```

![image](/assets/img/posts/OCI/OCI22_08.png)

### **2.2. sudo 권한 부여**

```bash
## wheel 그룹에 k8s-admin 추가
[opc@oke-bastion ~]$ sudo usermod -aG wheel k8s-admin

## k8s-admin 유저가 속한 그룹 확인
[opc@oke-bastion ~]$ groups k8s-admin
```

![image](/assets/img/posts/OCI/OCI22_09.png)

### **2.3. sudo 수행 시 NOPASSWORD 설정**

```bash
## /etc/sudoers 파일에서 NOPASSWD 항목 wheel 그룹 활성화
[opc@oke-bastion ~]$ sudo visudo
%wheel  ALL=(ALL) NOPASSWD: ALL
```

![image](/assets/img/posts/OCI/OCI22_10.png)

### **2.4. k8s-admin 유저 초기 패스워드 설정**

```bash
## root 계정 전환
[opc@oke-bastion ~]$ sudo su -

## k8s-admin 유저 패스워드 변경
[root@oke-bastion ~]# passwd k8s-admin
New password: <K8s123!@#>
Retype new password: <K8s123!@#>

## k8s-admin 접속 확인
[root@oke-bastion ~]# exit
[opc@oke-bastion ~]$ su - k8s-admin
Password: <K8s123!@#>
```

![image](/assets/img/posts/OCI/OCI22_11.png)

## **3. OCI CLI**

### **3.1. OCI CLI 설치**

```bash
## oke-admin 유저 전환
[opc@oke-bastion ~]$ su - k8s-admin

## 설치된 Python 버전 확인
[k8s-admin@oke-bastion ~]# python3 --version

## Python 버전에 맞는 OCI CLI 설치
[k8s-admin@oke-bastion ~]$ sudo yum install -y python39-oci-cli
```

![image](/assets/img/posts/OCI/OCI22_12.png)

### **3.2 OCI CLI 접속 정보 설정 (API Key 생성)**

```bash
[k8s-admin@oke-bastion ~]$ oci setup config
Enter a location for your config [/home/k8s-admin/.oci/config]: <Enter 입력>
Enter a user OCID: <User OCID 입력>
Enter a tenancy OCID: <Tenancy OCID 입력>
Enter a region by index or name(e.g.
1: af-johannesburg-1, 2: ap-chiyoda-1, 3: ap-chuncheon-1, 4: ap-chuncheon-2, 5: ap-dcc-canberra-1,
6: ap-dcc-gazipur-1, 7: ap-hyderabad-1, 8: ap-ibaraki-1, 9: ap-melbourne-1, 10: ap-mumbai-1,
11: ap-osaka-1, 12: ap-seoul-1, 13: ap-seoul-2, 14: ap-singapore-1, 15: ap-singapore-2,
...
71: us-sanjose-1, 72: us-somerset-1, 73: us-thames-1): ap-seoul-1
Do you want to generate a new API Signing RSA key pair? (If you decline you will be asked to supply the path to an existing key.) [Y/n]: Y
Enter a directory for your keys to be created [/home/k8s-admin/.oci]: <Enter 입력>
Enter a name for your key [oci_api_key]: <Enter 입력>
Public key written to: /home/k8s-admin/.oci/oci_api_key_public.pem
Enter a passphrase for your private key ("N/A" for no passphrase): <N/A 입력>
Repeat for confirmation: <N/A 입력>
```

![image](/assets/img/posts/OCI/OCI22_13.png)


> **User OCID 확인**
> 1. 테넌시 우측 상단 Profile → 계정명 or User setting 클릭
> 2. User information → OCID 복사
>   
> **Tenancy OCID 확인**
> 1. 테넌시 우측 상단 Profile → 테넌시: <테넌시명> 클릭
> 2. Tenancy information → OCID 복사
{: .prompt-info }


### **3.3. OCI Console API Key 등록**

1. 생성한 API Key 확인
    
    ```bash
    ## API Key가 생성된 경로로 이동
    [k8s-admin@oke-bastion ~]# cd .oci

    ## API Public Key 복사
    [k8s-admin@oke-bastion .oci]# cat oci_api_key_public.pem
    ```
    
    ![image](/assets/img/posts/OCI/OCI22_14.png)
    
2. 우측 상단 Profile → <계정명> 클릭
3. 좌측 하단 Resources → API keys
4. Paste a public key 선택 → 복사한 API Public key 붙여넣기
![image](/assets/img/posts/OCI/OCI22_15.png)
    
5. API 연동 확인
    
```bash
## 테넌시의 Object Storage namespace 출력
[k8s-admin@oke-bastion .oci]# oci os ns get
```

![image](/assets/img/posts/OCI/OCI22_16.png)
![image](/assets/img/posts/OCI/OCI22_17.png)

## **4. kubectl**

### **4.1. kubectl 바이너리 파일 다운**

```bash
[k8s-admin@oke-bastion ~]$ curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
```

![image](/assets/img/posts/OCI/OCI22_18.png)

### **4.2. kubectl 설치**

```bash
## kubectl 설치
[k8s-admin@oke-bastion ~]$ sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

## 설치된 kubectl 버전 확인
[k8s-admin@oke-bastion ~]$ kubectl version --client --output=yaml
```

![image](/assets/img/posts/OCI/OCI22_19.png)

### **4.3. kubeconfig 생성**

1. 생성한 OKE Cluster → 우측 상단 Actions → Access Cluster 클릭
![image](/assets/img/posts/OCI/OCI22_20.png)
    
2. Local Access → 단계 별 수행
    
    ```bash
    ## OCI CLI 설치 확인
    [k8s-admin@oke-bastion ~]$ oci -v
    
    ## kubeconfig 파일이 포함되는 디렉터리 생성
    [k8s-admin@oke-bastion ~]$ mkdir -p $HOME/.kube
    
    ## kubeconfig 생성
    [k8s-admin@oke-bastion ~]$ oci ce cluster create-kubeconfig --cluster-id ocid1.cluster.oc1.ap-seoul-1.aaaaaaaaez3qpqsyxwnyhkz7zai4mdgsxeoyyln2427csoowxc4sao3zrw2a --file $HOME/.kube/config --region ap-seoul-1 --token-version 2.0.0  --kube-endpoint PRIVATE_ENDPOINT
    
    ## kubeconfig 경로 환경변수 지정
    ## (.bash_profile 등록 필요)
    [k8s-admin@oke-bastion ~]$ export KUBECONFIG=$HOME/.kube/config
    ```
    
![image](/assets/img/posts/OCI/OCI22_21.png)
![image](/assets/img/posts/OCI/OCI22_22.png)
    

> **환경변수 영구 등록**
> - 사용자의 .bash_profile 파일에 등록 필요
> 
> ```bash
> ## .bash_profile 수정
> [k8s-admin@oke-basion ~]$ vi .bash_profile
> 
> ## vi편집기로 아래 내용 입력
> export KUBECONFIG=$HOME/.kube/config
> 
> ## .bash_profile 적용
> [k8s-admin@oke-basion ~]$ source .bash_profile
> ```
> 
> ![image](/assets/img/posts/OCI/OCI22_23.png)
> ![image](/assets/img/posts/OCI/OCI22_24.png)
> ![image](/assets/img/posts/OCI/OCI22_25.png)
{: .prompt-info }

### **4.4. kubeconfig 생성 확인**

```bash
## 생성된 파일 확인
## (context 정보 확인 가능)
[k8s-admin@oke-bastion ~]# more $HOME/.kube/config
```

![image](/assets/img/posts/OCI/OCI22_26.png)


> **쿠버네티스 컨텍스트**
> - 쿠버네티스 클러스터에 대한 정보를 담고 있는 설정
> - 여러 개의 클러스터를 하나의 파일에 저장하고, 다른 클러스터로 쉽게 전환 가능
> - 클러스터, 사용자, 네임스페이스로 구성
{: .prompt-info }

## **5. 클러스터 조회**

### **5.1. 클러스터 정보 조회**

```bash
[k8s-admin@oke-bastion ~]$ kubectl cluster-info
```

![image](/assets/img/posts/OCI/OCI22_27.png)

### **5.2. Worker nodes 정보 조회**

```bash
[k8s-admin@oke-bastion ~]# kubectl get nodes
```

![image](/assets/img/posts/OCI/OCI22_28.png)

---

[리눅스에 kubectl 설치 및 설정](https://kubernetes.io/ko/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux)