---
title: "[K8s] 쿠버네티스 설치(1)_VMware 노드 구성"      # 글 제목
date: 2024-03-25 23:51:00 +0900 # 작성 시간
categories: [DEVOPS, KUBERNETES]        # [대분류, 소분류]
tags: [k8s, kubernetes, vmware, node]     # 태그 (반드시 소문자로 시작 권장)
---
### 1\. 준비사항

 \- VMware workstation 17 pro
 \- ubuntu 20.04 LTS

### 2\. 가상 머신 생성  

![image](/assets/img/posts/Kubernetes/Kubernetes01_01.png)

1. master.labs.local
- RAM : 4G
- Disk : 20G+40G
- IP : 192.168.108.100/24
- GW : 192.168.108.2

2. node1.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.101/24
- GW : 192.168.108.2

3. node2.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.102/24
- GW : 192.168.108.2

4. node3.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.103/24
- GW : 192.168.108.2

### 3\. 쉘을 통해 접근
![image](/assets/img/posts/Kubernetes/Kubernetes01_02.png)
### 4\. 구성도
![image](/assets/img/posts/Kubernetes/Kubernetes01_03.png)
이 구성도 화면 참고하기

### 5\. root 계정 암호 설정
![image](/assets/img/posts/Kubernetes/Kubernetes01_04.png)

master.labs.local, node1.labs.local, node2.labs.local, node3.labs.local 모든 시스템에 같은 명령 입력

root 사용자의 패스워드 설정

### 6\. sudo 암호 묻지 않도록 설정
![image](/assets/img/posts/Kubernetes/Kubernetes01_05.png)

master.labs.local, node1.labs.local, node2.labs.local, node3.labs.local 모든 시스템에 같은 명령 입력

ubuntu 계정에서 sudo 명령으로 super user 권한을 획득할 때 패스워드를 묻지 않도록

### 7\. hostname 변경
![image](/assets/img/posts/Kubernetes/Kubernetes01_06.png)
hostnamectl set-hostname \[변경할 호스트명\] 명령으로 각 시스템에 맞는 호스트네임 설정

![image](/assets/img/posts/Kubernetes/Kubernetes01_07.png)
재부팅(init 6) 후 변경된 호스트네임 확인하기

### 8\. 호스트 파일 변경
![image](/assets/img/posts/Kubernetes/Kubernetes01_08.png)

master.labs.local의 /etc/hosts 파일 변경

### 9\. 모든 노드에서 root 사용자 ssh 접근 허용
![image](/assets/img/posts/Kubernetes/Kubernetes01_09.png)

ssh를 통해 서버에 로그인할 때 root 계정으로의 로그인 허용

![image](/assets/img/posts/Kubernetes/Kubernetes01_10.png)

ssh를 통해 서버에 로그인할 때 비밀번호 인증을 사용하도록 설정

![image](/assets/img/posts/Kubernetes/Kubernetes01_11.png)

sshd 데몬 재실행

### 10\. ubuntu 사용자 개인키, 공개키 생성
![image](/assets/img/posts/Kubernetes/Kubernetes01_12.png)

ubuntu 사용자의 rsa 타입의 개인키와 공개키 생성(모두 기본값으로 생성함)

### 11\. 공개키 서버로 배포
![image](/assets/img/posts/Kubernetes/Kubernetes01_13.png)

기본으로 생성되어 있던 authorized\_keys 파일 삭제, 생성한 공개키를 해당 위치의 해당 이름으로 복사해야 함

\* authorized\_keys : 서버의 공개키가 위치하게 되는 경로 파일

![image](/assets/img/posts/Kubernetes/Kubernetes01_14.png)

master.labs.local 시스템에서 /home/ubuntu/.ssh/id\_rsa 이름으로 생성한 공개키를 node1.labs.local, node2.labs.local, node3.labs.local로 복사(이때 생성된 호스트키의 핑거프린트를 이용해서 접속(yes 입력한 것))

for 구문을 이용해 $i 변수에 1~3까지 1씩 증가하면서 넣음

### 12\. /etc/hosts 파일 전송
![image](/assets/img/posts/Kubernetes/Kubernetes01_15.png)

master.labs.local 시스템에서 수정한 /etc/hosts 파일을 for문을 이용해 node1, node2, node3에 복사

### 13\. 방화벽 해제
![image](/assets/img/posts/Kubernetes/Kubernetes01_16.png)

모든 노드에서 활성화 되어 있는 방화벽 해제

### 14\. swap 중지
![image](/assets/img/posts/Kubernetes/Kubernetes01_17.png)

메모리가 부족할 경우 디스크의 일부 용량을 메모리로 사용하는 보조 메모리 개념의 swap을 비활성화

### 15\. br\_netfilter 모듈 로드
![image](/assets/img/posts/Kubernetes/Kubernetes01_18.png)

### 16\. 명시적으로 로드하기
![image](/assets/img/posts/Kubernetes/Kubernetes01_19.png)