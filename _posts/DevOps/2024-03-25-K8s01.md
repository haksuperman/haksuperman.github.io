---
title: "[K8s] 쿠버네티스 설치(1)_VMware 노드 구성"      # 글 제목
date: 2024-03-25 23:51:00 +0900 # 작성 시간
categories: [DEVOPS, KUBERNETES]        # [대분류, 소분류]
tags: [k8s, kubernetes, vmware, node]     # 태그 (반드시 소문자로 시작 권장)
---
### 1\. 준비사항

 \- VMware workstation 17 pro
 \- ubuntu 20.04 LTS

### 2\. 가상 머신 생성  

![image](https://blog.kakaocdn.net/dna/Ru1Pk/btsF2NmBrJp/AAAAAAAAAAAAAAAAAAAAAAkOPle4wDGjwSuHSeCB-W6ZhFPYo3TG10komOJ5rDN3/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=qqAfdWJdA9FvI43mPr4DirxUp%2BI%3D)

1. master.labs.local
- RAM : 4G
- Disk : 20G+40G
- IP : 192.168.108.100/24
- GW : 192.168.108.2

2. node1.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.101/24
- GW : 192.168.108.2

3. node2.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.102/24
- GW : 192.168.108.2

4. node3.labs.local
- RAM : 2G
- Disk : 20G+40G
- IP : 192.168.108.103/24
- GW : 192.168.108.2

### 3\. 쉘을 통해 접근
![image](https://blog.kakaocdn.net/dna/VgLNh/btsF3DjwOMB/AAAAAAAAAAAAAAAAAAAAABrOqjQNox6YYHWhyAnBksugmPoTHqeNKsnwoWlrmyw6/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=6y0oBL4NZzzJukThLknNJ0kvSNo%3D)

### 4\. 구성도
![image](https://blog.kakaocdn.net/dna/bxDyVy/btsF5Ij4MX8/AAAAAAAAAAAAAAAAAAAAAGRdOrHiEfTHsLPv3UuyCz92DPq-yXIhUwkVD612FVWm/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=%2BpI6rVz%2BAy%2BEr6bhpsB86ivIRrA%3D)
이 구성도 화면 참고하기

### 5\. root 계정 암호 설정
![image](https://blog.kakaocdn.net/dna/bESMka/btsF62oGXAo/AAAAAAAAAAAAAAAAAAAAAPSt0D7hRrOLH7HPSqS2IrTqOs53nOJ19i77cZNrOTxI/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=u59ULfCBrrzMz75WrjO0W3ccRYU%3D)

master.labs.local, node1.labs.local, node2.labs.local, node3.labs.local 모든 시스템에 같은 명령 입력

root 사용자의 패스워드 설정

### 6\. sudo 암호 묻지 않도록 설정
![image](https://blog.kakaocdn.net/dna/bYyYPG/btsF2uOlAvQ/AAAAAAAAAAAAAAAAAAAAAOuZwjiThJ-AvlJ8qWv71KekU9kzvxxRBKWzT9Is-5sR/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=9YOokxrwGihnxVIDZbT%2FKQ4q3DA%3D)

master.labs.local, node1.labs.local, node2.labs.local, node3.labs.local 모든 시스템에 같은 명령 입력

ubuntu 계정에서 sudo 명령으로 super user 권한을 획득할 때 패스워드를 묻지 않도록

### 7\. hostname 변경
![image](https://blog.kakaocdn.net/dna/nKMjy/btsF6Iql7re/AAAAAAAAAAAAAAAAAAAAABj0yEnCKpSFzv5LeYr9-TuKjhV8hQVZg_iPcJpVayQS/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=G1zrjJaGUPBcNBD7aIg6WNDv5Gw%3D)
hostnamectl set-hostname \[변경할 호스트명\] 명령으로 각 시스템에 맞는 호스트네임 설정

![image](https://blog.kakaocdn.net/dna/b3HWrg/btsF5A7wbHI/AAAAAAAAAAAAAAAAAAAAAHtpVaZkDbaRnclfdM0IDX00juTl5sr-z_fWobr1xBfJ/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=14eJi%2B4iEJSHPhaB15fnY1HRBXE%3D)
재부팅(init 6) 후 변경된 호스트네임 확인하기

### 8\. 호스트 파일 변경
![image](https://blog.kakaocdn.net/dna/bicLGB/btsF2Guliq5/AAAAAAAAAAAAAAAAAAAAAMkNfOaqxga0PFKwWV7EioDpv-r7tpY168qEqmm16Mb7/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=KaFCqMKH28%2BGrpJt1GE1QK6OndE%3D)

master.labs.local의 /etc/hosts 파일 변경

### 9\. 모든 노드에서 root 사용자 ssh 접근 허용
![image](https://blog.kakaocdn.net/dna/c9HwMd/btsF3d6qNkv/AAAAAAAAAAAAAAAAAAAAAKMCyVJRq5KQjBrNBWIB0y8GCG-f3P34WFfuLm4pb7nC/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=kdM50DZxzvzbfQuGndIk%2BZ33S%2Bs%3D)

ssh를 통해 서버에 로그인할 때 root 계정으로의 로그인 허용

![image](https://blog.kakaocdn.net/dna/o2zrV/btsF56yeHEr/AAAAAAAAAAAAAAAAAAAAAFOo2a-eqlf8egnrTB38ej7DcCkdgpZCrKbH-mG6qg1N/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=xU56brbWCkWerqm280A5peAgZEk%3D)

ssh를 통해 서버에 로그인할 때 비밀번호 인증을 사용하도록 설정

![image](https://blog.kakaocdn.net/dna/eMLhBF/btsF2ywpIct/AAAAAAAAAAAAAAAAAAAAAK46Y-0n58qlRognkqnSDrI7ePssoXBUL8xIlnFzh-Ed/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=4yFeYf5yPdj7YXiFY11AVkmvGe4%3D)

sshd 데몬 재실행

### 10\. ubuntu 사용자 개인키, 공개키 생성
![image](https://blog.kakaocdn.net/dna/AcuDM/btsF5IK9bOL/AAAAAAAAAAAAAAAAAAAAAILiKK3a35QGCMvLZ10TKJ6p0G29z1Vk_iZsFPbFOfzt/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=7YF630uFo%2FM9S9i%2BkRfPla2dk%2FI%3D)

ubuntu 사용자의 rsa 타입의 개인키와 공개키 생성(모두 기본값으로 생성함)

### 11\. 공개키 서버로 배포
![image](https://blog.kakaocdn.net/dna/cQHSnX/btsF2F3gwQY/AAAAAAAAAAAAAAAAAAAAAOeXWH28i6EUENG85C3aOR7hPK3BoXxCeZvjlFqERsCm/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=nsPlZ1I0FPNQcGeoF6amKtZH8%2F4%3D)

기본으로 생성되어 있던 authorized\_keys 파일 삭제, 생성한 공개키를 해당 위치의 해당 이름으로 복사해야 함

\* authorized\_keys : 서버의 공개키가 위치하게 되는 경로 파일

![image](https://blog.kakaocdn.net/dna/bpApY5/btsF5HMd8MY/AAAAAAAAAAAAAAAAAAAAADonEv9l431YKcYzNW1UpHORNGYp2Qt38tnNEl3ANRhr/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=ayTUS9FGuulmkCeKNBupWf23nM0%3D)

master.labs.local 시스템에서 /home/ubuntu/.ssh/id\_rsa 이름으로 생성한 공개키를 node1.labs.local, node2.labs.local, node3.labs.local로 복사(이때 생성된 호스트키의 핑거프린트를 이용해서 접속(yes 입력한 것))

for 구문을 이용해 $i 변수에 1~3까지 1씩 증가하면서 넣음

### 12\. /etc/hosts 파일 전송
![image](https://blog.kakaocdn.net/dna/cHEcdV/btsF5FVbxKZ/AAAAAAAAAAAAAAAAAAAAAMFLs_L6cjPTUibg8Z8y0oIbzOhWp0vtlJiMTSwdeU9J/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=%2F5U8YQyzKGCAwqAo3yjvgnVmUD8%3D)

master.labs.local 시스템에서 수정한 /etc/hosts 파일을 for문을 이용해 node1, node2, node3에 복사

### 13\. 방화벽 해제
![image](https://blog.kakaocdn.net/dna/blmeQ8/btsF62PLxpk/AAAAAAAAAAAAAAAAAAAAAAVQGewiF4JJYBa5_wQMWY1m0WxhyJZeSxDCVzklBL-c/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=XOv%2BtlsddxUQSd4e9K%2FWym6JPME%3D)

모든 노드에서 활성화 되어 있는 방화벽 해제

### 14\. swap 중지
![image](https://blog.kakaocdn.net/dna/cbZPg1/btsF5vSPzzF/AAAAAAAAAAAAAAAAAAAAABWkEQ3-43JPN95BnVy6FbnLqk3OCWTM5EsYNPfRkZJU/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=L182KhKwVuxOQQ912K2sm%2BBJYrs%3D)

메모리가 부족할 경우 디스크의 일부 용량을 메모리로 사용하는 보조 메모리 개념의 swap을 비활성화

### 15\. br\_netfilter 모듈 로드
![image](https://blog.kakaocdn.net/dna/yS8jg/btsF65eD9dw/AAAAAAAAAAAAAAAAAAAAAPkf2jQErWfHJhYWFv0CPYmCDoMSpJ8qEKCq5ZhoPC-0/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=vXi8WMBuUWDOg07r%2F%2BZe5FcntjU%3D)

### 16\. 명시적으로 로드하기
![image](https://blog.kakaocdn.net/dna/JQWwJ/btsF6fBOdwK/AAAAAAAAAAAAAAAAAAAAANOA77eSfnq1ijyzT1Pes2h5I5-We0dJWmiiUsRqv-5w/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1767193199&allow_ip=&allow_referer=&signature=6h%2BaLiRGy%2FFUCy%2FjQHNeH4T7tXE%3D)